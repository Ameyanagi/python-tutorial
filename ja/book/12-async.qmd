# éåŒæœŸãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¨ä¸¦è¡Œæ€§

éåŒæœŸãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ã“ã¨ãªãè¤‡æ•°ã®ã‚¿ã‚¹ã‚¯ã‚’åŠ¹ç‡çš„ã«å‡¦ç†ã§ãã‚‹ä¸¦è¡Œã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°ã§ãã¾ã™ã€‚ã“ã‚Œã¯ã€Webãƒªã‚¯ã‚¨ã‚¹ãƒˆã€ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªãªã©ã®I/Oãƒã‚¦ãƒ³ãƒ‰ãªæ“ä½œã«æœ€é©ã§ã™ã€‚

## éåŒæœŸãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ç†è§£

### åŒæœŸ vs éåŒæœŸ

```{python}
import time
import asyncio

# åŒæœŸçš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒ - ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°
def sync_task(name: str, duration: int) -> str:
    """æ™‚é–“ã®ã‹ã‹ã‚‹ã‚¿ã‚¹ã‚¯ã‚’åŒæœŸçš„ã«ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ"""
    print(f"{name}ã‚’é–‹å§‹...")
    time.sleep(duration)  # ãƒ—ãƒ­ã‚°ãƒ©ãƒ å…¨ä½“ã‚’ãƒ–ãƒ­ãƒƒã‚¯
    print(f"{name}ã‚’å®Œäº†")
    return f"{name}ã‹ã‚‰ã®çµæœ"

def run_sync_tasks():
    """è¤‡æ•°ã®ã‚¿ã‚¹ã‚¯ã‚’åŒæœŸçš„ã«å®Ÿè¡Œ"""
    print("=== åŒæœŸå®Ÿè¡Œ ===")
    start_time = time.time()
    
    result1 = sync_task("ã‚¿ã‚¹ã‚¯1", 2)
    result2 = sync_task("ã‚¿ã‚¹ã‚¯2", 2)
    result3 = sync_task("ã‚¿ã‚¹ã‚¯3", 2)
    
    end_time = time.time()
    print(f"åˆè¨ˆæ™‚é–“: {end_time - start_time:.2f}ç§’")
    return [result1, result2, result3]

# éåŒæœŸçš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒ - ãƒãƒ³ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°
async def async_task(name: str, duration: int) -> str:
    """æ™‚é–“ã®ã‹ã‹ã‚‹ã‚¿ã‚¹ã‚¯ã‚’éåŒæœŸçš„ã«ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ"""
    print(f"{name}ã‚’é–‹å§‹...")
    await asyncio.sleep(duration)  # ãƒãƒ³ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ãªå¾…æ©Ÿ
    print(f"{name}ã‚’å®Œäº†")
    return f"{name}ã‹ã‚‰ã®çµæœ"

async def run_async_tasks():
    """è¤‡æ•°ã®ã‚¿ã‚¹ã‚¯ã‚’éåŒæœŸçš„ã«å®Ÿè¡Œ"""
    print("\n=== éåŒæœŸå®Ÿè¡Œ ===")
    start_time = time.time()
    
    # ã‚¿ã‚¹ã‚¯ã‚’ä¸¦è¡Œå®Ÿè¡Œ
    results = await asyncio.gather(
        async_task("ã‚¿ã‚¹ã‚¯1", 2),
        async_task("ã‚¿ã‚¹ã‚¯2", 2),
        async_task("ã‚¿ã‚¹ã‚¯3", 2)
    )
    
    end_time = time.time()
    print(f"åˆè¨ˆæ™‚é–“: {end_time - start_time:.2f}ç§’")
    return results

# å®Ÿè¡Œæ¯”è¼ƒ
print("åŒæœŸã¨éåŒæœŸã®å®Ÿè¡Œæ™‚é–“æ¯”è¼ƒ:")
sync_results = run_sync_tasks()

# éåŒæœŸã®å®Ÿè¡Œ
async_results = await run_async_tasks()
```

## åŸºæœ¬çš„ãªéåŒæœŸãƒ‘ã‚¿ãƒ¼ãƒ³

### async/await ã®åŸºæœ¬

```{python}
import asyncio
import random

async def fetch_data(url: str) -> str:
    """Webã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹æ¨¡æ“¬é–¢æ•°"""
    print(f"ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­: {url}")
    
    # ãƒ©ãƒ³ãƒ€ãƒ ãªé…å»¶ã§å®Ÿéš›ã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
    delay = random.uniform(1, 3)
    await asyncio.sleep(delay)
    
    print(f"ãƒ‡ãƒ¼ã‚¿å–å¾—å®Œäº†: {url}")
    return f"{url}ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿"

async def process_data(data: str) -> str:
    """ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ã™ã‚‹æ¨¡æ“¬é–¢æ•°"""
    print(f"ãƒ‡ãƒ¼ã‚¿å‡¦ç†ä¸­: {data}")
    
    # å‡¦ç†æ™‚é–“ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
    await asyncio.sleep(1)
    
    processed = f"å‡¦ç†æ¸ˆã¿: {data}"
    print(f"ãƒ‡ãƒ¼ã‚¿å‡¦ç†å®Œäº†: {processed}")
    return processed

async def fetch_and_process(url: str) -> str:
    """ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã¨å‡¦ç†ã‚’é †åºå®Ÿè¡Œ"""
    # æ®µéšçš„ãªå‡¦ç†
    raw_data = await fetch_data(url)
    processed_data = await process_data(raw_data)
    return processed_data

# è¤‡æ•°URLã®ä¸¦è¡Œå‡¦ç†
async def main():
    urls = [
        "https://api.example1.com",
        "https://api.example2.com", 
        "https://api.example3.com"
    ]
    
    print("=== è¤‡æ•°URLã®ä¸¦è¡Œå‡¦ç† ===")
    start_time = time.time()
    
    results = await asyncio.gather(
        *[fetch_and_process(url) for url in urls]
    )
    
    end_time = time.time()
    print(f"\nå‡¦ç†å®Œäº†ï¼åˆè¨ˆæ™‚é–“: {end_time - start_time:.2f}ç§’")
    
    for i, result in enumerate(results, 1):
        print(f"çµæœ{i}: {result}")

# å®Ÿè¡Œ
await main()
```

## ã‚³ãƒ«ãƒ¼ãƒãƒ³ã¨ã‚¿ã‚¹ã‚¯

### Task ã®ä½œæˆã¨ç®¡ç†

```{python}
import asyncio
from typing import List

async def download_file(filename: str, size_mb: int) -> str:
    """ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ"""
    print(f"ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é–‹å§‹: {filename} ({size_mb}MB)")
    
    # ã‚µã‚¤ã‚ºã«æ¯”ä¾‹ã—ãŸãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ™‚é–“
    download_time = size_mb * 0.5
    await asyncio.sleep(download_time)
    
    print(f"ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å®Œäº†: {filename}")
    return f"{filename} (ã‚µã‚¤ã‚º: {size_mb}MB)"

async def monitor_downloads():
    """ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç›£è¦–"""
    for i in range(5):
        print(f"ç›£è¦–ä¸­... ({i+1}/5)")
        await asyncio.sleep(1)
    print("ç›£è¦–çµ‚äº†")

async def manage_downloads():
    """ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¿ã‚¹ã‚¯ã®ç®¡ç†"""
    print("=== ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  ===")
    
    # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ
    download_tasks = [
        asyncio.create_task(download_file("document.pdf", 10)),
        asyncio.create_task(download_file("video.mp4", 25)), 
        asyncio.create_task(download_file("image.jpg", 5)),
        asyncio.create_task(download_file("software.zip", 15))
    ]
    
    # ç›£è¦–ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ
    monitor_task = asyncio.create_task(monitor_downloads())
    
    # ã™ã¹ã¦ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒå®Œäº†ã™ã‚‹ã¾ã§å¾…æ©Ÿ
    print("ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é–‹å§‹...")
    completed_downloads = await asyncio.gather(*download_tasks)
    
    # ç›£è¦–ã‚¿ã‚¹ã‚¯ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
    if not monitor_task.done():
        monitor_task.cancel()
        try:
            await monitor_task
        except asyncio.CancelledError:
            print("ç›£è¦–ã‚¿ã‚¹ã‚¯ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ")
    
    print("\nã™ã¹ã¦ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒå®Œäº†:")
    for download in completed_downloads:
        print(f"  - {download}")

# å®Ÿè¡Œ
await manage_downloads()
```

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

### å …ç‰¢ãªéåŒæœŸå‡¦ç†

```{python}
import asyncio
import random

async def unreliable_api_call(api_name: str) -> str:
    """ä¸å®‰å®šãªAPIã‚³ãƒ¼ãƒ«ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ"""
    print(f"APIå‘¼ã³å‡ºã—ä¸­: {api_name}")
    
    # ãƒ©ãƒ³ãƒ€ãƒ ãªé…å»¶
    delay = random.uniform(1, 5)
    await asyncio.sleep(delay)
    
    # ãƒ©ãƒ³ãƒ€ãƒ ã«å¤±æ•—ã™ã‚‹
    if random.random() < 0.3:  # 30%ã®ç¢ºç‡ã§å¤±æ•—
        raise Exception(f"{api_name}ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ")
    
    print(f"APIå‘¼ã³å‡ºã—æˆåŠŸ: {api_name}")
    return f"{api_name}ã‹ã‚‰ã®å¿œç­”ãƒ‡ãƒ¼ã‚¿"

async def safe_api_call(api_name: str, timeout: float = 3.0, retries: int = 3) -> str:
    """ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¨ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ä»˜ãã®APIã‚³ãƒ¼ãƒ«"""
    
    for attempt in range(retries):
        try:
            print(f"è©¦è¡Œ {attempt + 1}/{retries}: {api_name}")
            
            # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ãã§å®Ÿè¡Œ
            result = await asyncio.wait_for(
                unreliable_api_call(api_name),
                timeout=timeout
            )
            
            return result
            
        except asyncio.TimeoutError:
            print(f"ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: {api_name} (è©¦è¡Œ {attempt + 1}/{retries})")
            if attempt == retries - 1:
                raise Exception(f"{api_name}: {retries}å›ã™ã¹ã¦ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ")
            
        except Exception as e:
            print(f"ã‚¨ãƒ©ãƒ¼: {api_name} - {e} (è©¦è¡Œ {attempt + 1}/{retries})")
            if attempt == retries - 1:
                raise e
            
            # æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã§ãƒªãƒˆãƒ©ã‚¤é–“éš”ã‚’èª¿æ•´
            await asyncio.sleep(2 ** attempt)
    
    raise Exception(f"{api_name}: äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼")

async def batch_api_calls():
    """è¤‡æ•°ã®APIã‚³ãƒ¼ãƒ«ã‚’ä¸¦è¡Œå®Ÿè¡Œï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä»˜ãï¼‰"""
    apis = ["UserAPI", "ProductAPI", "OrderAPI", "PaymentAPI"]
    
    results = []
    errors = []
    
    # ã™ã¹ã¦ã®APIã‚³ãƒ¼ãƒ«ã‚’ä¸¦è¡Œå®Ÿè¡Œ
    tasks = [safe_api_call(api) for api in apis]
    
    # as_completed ã§å®Œäº†é †ã«å‡¦ç†
    print("=== ä¸¦è¡ŒAPIã‚³ãƒ¼ãƒ«ï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä»˜ãï¼‰ ===")
    for completed_task in asyncio.as_completed(tasks):
        try:
            result = await completed_task
            results.append(result)
            print(f"âœ… æˆåŠŸ: {result}")
        except Exception as e:
            errors.append(str(e))
            print(f"âŒ å¤±æ•—: {e}")
    
    print(f"\nçµæœ: æˆåŠŸ {len(results)}, å¤±æ•— {len(errors)}")
    return results, errors

# å®Ÿè¡Œ
await batch_api_calls()
```

## å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä¾‹

### éåŒæœŸWebã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°

```{python}
import asyncio
import time
from typing import Dict, List

class AsyncWebScraper:
    """éåŒæœŸWebã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‚¯ãƒ©ã‚¹"""
    
    def __init__(self, max_concurrent: int = 5):
        self.max_concurrent = max_concurrent
        self.semaphore = asyncio.Semaphore(max_concurrent)
        self.session_active = False
    
    async def fetch_page(self, url: str) -> Dict:
        """å˜ä¸€ãƒšãƒ¼ã‚¸ã®å–å¾—"""
        async with self.semaphore:  # åŒæ™‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã‚’åˆ¶é™
            print(f"å–å¾—ä¸­: {url}")
            
            # HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            delay = random.uniform(0.5, 2.0)
            await asyncio.sleep(delay)
            
            # æ¨¡æ“¬ãƒ¬ã‚¹ãƒãƒ³ã‚¹
            response = {
                "url": url,
                "title": f"ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ« from {url}",
                "content_length": random.randint(1000, 10000),
                "load_time": delay
            }
            
            print(f"å®Œäº†: {url} ({delay:.2f}ç§’)")
            return response
    
    async def scrape_multiple(self, urls: List[str]) -> List[Dict]:
        """è¤‡æ•°ãƒšãƒ¼ã‚¸ã®ä¸¦è¡Œå–å¾—"""
        print(f"=== éåŒæœŸã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°é–‹å§‹ ===")
        print(f"å¯¾è±¡URLæ•°: {len(urls)}, æœ€å¤§åŒæ™‚æ¥ç¶šæ•°: {self.max_concurrent}")
        
        start_time = time.time()
        
        # ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ
        tasks = [self.fetch_page(url) for url in urls]
        
        # å®Œäº†é †ã«çµæœã‚’åé›†
        results = []
        for completed_task in asyncio.as_completed(tasks):
            try:
                result = await completed_task
                results.append(result)
                print(f"é€²æ—: {len(results)}/{len(urls)}")
            except Exception as e:
                print(f"ã‚¨ãƒ©ãƒ¼: {e}")
        
        end_time = time.time()
        total_time = end_time - start_time
        
        print(f"\n=== ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å®Œäº† ===")
        print(f"ç·æ™‚é–“: {total_time:.2f}ç§’")
        print(f"å¹³å‡æ™‚é–“/URL: {total_time/len(urls):.2f}ç§’")
        
        return results

# ãƒãƒ£ãƒƒãƒˆå¿œç­”ã‚·ã‚¹ãƒ†ãƒ 
class AsyncChatBot:
    """éåŒæœŸãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ"""
    
    def __init__(self):
        self.conversation_history = []
        self.processing_queue = asyncio.Queue()
        self.response_cache = {}
    
    async def process_message(self, user_id: str, message: str) -> str:
        """ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡¦ç†ã—ã¦å¿œç­”ã‚’ç”Ÿæˆ"""
        print(f"ãƒ¦ãƒ¼ã‚¶ãƒ¼{user_id}: {message}")
        
        # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ãƒã‚§ãƒƒã‚¯
        cache_key = message.lower().strip()
        if cache_key in self.response_cache:
            print(f"ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å¿œç­”: {cache_key}")
            return self.response_cache[cache_key]
        
        # å‡¦ç†æ™‚é–“ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
        thinking_time = random.uniform(1, 3)
        await asyncio.sleep(thinking_time)
        
        # æ¨¡æ“¬å¿œç­”ç”Ÿæˆ
        responses = [
            f"ã€Œ{message}ã€ã«ã¤ã„ã¦è€ƒãˆã¦ã„ã¾ã™...",
            f"ãã‚Œã¯èˆˆå‘³æ·±ã„è³ªå•ã§ã™ã­ã€‚{message}ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚",
            f"{message}ã«é–¢ã™ã‚‹æƒ…å ±ã‚’ãŠèª¿ã¹ã—ã¾ã—ãŸã€‚",
            f"ã”è³ªå•ã®{message}ã«ã¤ã„ã¦ãŠç­”ãˆã—ã¾ã™ã€‚"
        ]
        
        response = random.choice(responses)
        
        # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
        self.response_cache[cache_key] = response
        
        # ä¼šè©±å±¥æ­´ã«è¿½åŠ 
        self.conversation_history.append({
            "user_id": user_id,
            "message": message,
            "response": response,
            "timestamp": time.time()
        })
        
        print(f"ãƒœãƒƒãƒˆ â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼{user_id}: {response}")
        return response
    
    async def handle_multiple_users(self, messages: List[tuple]) -> List[str]:
        """è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¸¦è¡Œå‡¦ç†"""
        print("=== ãƒãƒ«ãƒãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ£ãƒƒãƒˆå‡¦ç† ===")
        
        tasks = [
            self.process_message(user_id, message) 
            for user_id, message in messages
        ]
        
        responses = await asyncio.gather(*tasks)
        
        print(f"\nå‡¦ç†å®Œäº†: {len(responses)}ä»¶ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸")
        return responses

# ä½¿ç”¨ä¾‹
async def demo_applications():
    """å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä¾‹ã®ãƒ‡ãƒ¢"""
    
    # 1. Webã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã®ãƒ‡ãƒ¢
    scraper = AsyncWebScraper(max_concurrent=3)
    urls = [
        "https://example1.com",
        "https://example2.com", 
        "https://example3.com",
        "https://example4.com",
        "https://example5.com"
    ]
    
    scraping_results = await scraper.scrape_multiple(urls)
    
    print(f"\nã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°çµæœ: {len(scraping_results)}ãƒšãƒ¼ã‚¸å–å¾—")
    
    # 2. ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã®ãƒ‡ãƒ¢  
    print("\n" + "="*50)
    
    chatbot = AsyncChatBot()
    user_messages = [
        ("001", "Pythonã«ã¤ã„ã¦æ•™ãˆã¦"),
        ("002", "éåŒæœŸãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¨ã¯ä½•ã§ã™ã‹ï¼Ÿ"),
        ("003", "Pythonã«ã¤ã„ã¦æ•™ãˆã¦"),  # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã‚‹
        ("004", "AIã®å°†æ¥ã«ã¤ã„ã¦"),
        ("001", "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™")
    ]
    
    chat_responses = await chatbot.handle_multiple_users(user_messages)
    
    print(f"\nãƒãƒ£ãƒƒãƒˆå‡¦ç†å®Œäº†: {len(chat_responses)}ä»¶ã®å¿œç­”")

# å®Ÿè¡Œ
await demo_applications()
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ã¨æœ€é©åŒ–

### éåŒæœŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ç›£è¦–

```{python}
import asyncio
import time
from dataclasses import dataclass
from typing import Callable, Any

@dataclass
class TaskMetrics:
    """ã‚¿ã‚¹ã‚¯ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹"""
    name: str
    start_time: float
    end_time: float = 0
    duration: float = 0
    status: str = "running"
    result: Any = None
    error: str = None

class AsyncProfiler:
    """éåŒæœŸå‡¦ç†ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ©ãƒ¼"""
    
    def __init__(self):
        self.metrics = {}
        self.start_time = time.time()
    
    def profile_task(self, name: str):
        """ã‚¿ã‚¹ã‚¯ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿"""
        def decorator(func: Callable):
            async def wrapper(*args, **kwargs):
                task_id = f"{name}_{id(asyncio.current_task())}"
                
                # ãƒ¡ãƒˆãƒªã‚¯ã‚¹é–‹å§‹
                self.metrics[task_id] = TaskMetrics(
                    name=name,
                    start_time=time.time()
                )
                
                try:
                    result = await func(*args, **kwargs)
                    
                    # æˆåŠŸæ™‚ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
                    metric = self.metrics[task_id]
                    metric.end_time = time.time()
                    metric.duration = metric.end_time - metric.start_time
                    metric.status = "completed"
                    metric.result = result
                    
                    return result
                    
                except Exception as e:
                    # ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
                    metric = self.metrics[task_id]
                    metric.end_time = time.time()
                    metric.duration = metric.end_time - metric.start_time
                    metric.status = "failed"
                    metric.error = str(e)
                    
                    raise e
            
            return wrapper
        return decorator
    
    def get_summary(self) -> dict:
        """å®Ÿè¡Œã‚µãƒãƒªãƒ¼ã‚’å–å¾—"""
        if not self.metrics:
            return {"message": "ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãŒã‚ã‚Šã¾ã›ã‚“"}
        
        completed = [m for m in self.metrics.values() if m.status == "completed"]
        failed = [m for m in self.metrics.values() if m.status == "failed"]
        running = [m for m in self.metrics.values() if m.status == "running"]
        
        total_duration = time.time() - self.start_time
        
        summary = {
            "ç·å®Ÿè¡Œæ™‚é–“": f"{total_duration:.2f}ç§’",
            "ç·ã‚¿ã‚¹ã‚¯æ•°": len(self.metrics),
            "å®Œäº†": len(completed),
            "å¤±æ•—": len(failed), 
            "å®Ÿè¡Œä¸­": len(running)
        }
        
        if completed:
            durations = [m.duration for m in completed]
            summary.update({
                "å¹³å‡å®Ÿè¡Œæ™‚é–“": f"{sum(durations)/len(durations):.2f}ç§’",
                "æœ€çŸ­å®Ÿè¡Œæ™‚é–“": f"{min(durations):.2f}ç§’",
                "æœ€é•·å®Ÿè¡Œæ™‚é–“": f"{max(durations):.2f}ç§’"
            })
        
        return summary
    
    def print_detailed_report(self):
        """è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆã‚’è¡¨ç¤º"""
        print("=== éåŒæœŸå‡¦ç†è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆ ===")
        
        for task_id, metric in self.metrics.items():
            status_emoji = {
                "completed": "âœ…",
                "failed": "âŒ", 
                "running": "ğŸ”„"
            }.get(metric.status, "â“")
            
            print(f"{status_emoji} {metric.name}")
            print(f"   æ™‚é–“: {metric.duration:.2f}ç§’")
            print(f"   ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: {metric.status}")
            
            if metric.error:
                print(f"   ã‚¨ãƒ©ãƒ¼: {metric.error}")
            print()
        
        summary = self.get_summary()
        print("=== ã‚µãƒãƒªãƒ¼ ===")
        for key, value in summary.items():
            print(f"{key}: {value}")

# ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ©ãƒ¼ã‚’ä½¿ç”¨ã—ãŸãƒ‡ãƒ¢
profiler = AsyncProfiler()

@profiler.profile_task("ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¤œç´¢")
async def database_query(query: str) -> str:
    """ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ"""
    await asyncio.sleep(random.uniform(0.5, 2.0))
    if random.random() < 0.1:  # 10%ã®ç¢ºç‡ã§å¤±æ•—
        raise Exception("ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼")
    return f"ã‚¯ã‚¨ãƒªçµæœ: {query}"

@profiler.profile_task("APIå‘¼ã³å‡ºã—")
async def api_call(endpoint: str) -> str:
    """APIå‘¼ã³å‡ºã—ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ"""
    await asyncio.sleep(random.uniform(1.0, 3.0))
    if random.random() < 0.15:  # 15%ã®ç¢ºç‡ã§å¤±æ•—
        raise Exception("APIå¿œç­”ã‚¨ãƒ©ãƒ¼")
    return f"APIå¿œç­”: {endpoint}"

@profiler.profile_task("ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†")
async def file_processing(filename: str) -> str:
    """ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ"""
    await asyncio.sleep(random.uniform(0.3, 1.5))
    return f"å‡¦ç†æ¸ˆã¿: {filename}"

async def run_performance_demo():
    """ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ãƒ‡ãƒ¢"""
    print("=== ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ãƒ‡ãƒ¢é–‹å§‹ ===")
    
    # è¤‡æ•°ã®ã‚¿ã‚¹ã‚¯ã‚’ä¸¦è¡Œå®Ÿè¡Œ
    tasks = []
    
    # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã‚¿ã‚¹ã‚¯
    for i in range(5):
        tasks.append(database_query(f"SELECT * FROM table_{i}"))
    
    # APIå‘¼ã³å‡ºã—ã‚¿ã‚¹ã‚¯
    endpoints = ["users", "products", "orders", "payments"]
    for endpoint in endpoints:
        tasks.append(api_call(endpoint))
    
    # ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ã‚¿ã‚¹ã‚¯
    files = ["data1.csv", "data2.json", "report.pdf"]
    for filename in files:
        tasks.append(file_processing(filename))
    
    # ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œ
    results = await asyncio.gather(*tasks, return_exceptions=True)
    
    # çµæœã®åˆ†æ
    successful_results = [r for r in results if not isinstance(r, Exception)]
    failed_results = [r for r in results if isinstance(r, Exception)]
    
    print(f"\n=== å®Ÿè¡Œçµæœ ===")
    print(f"æˆåŠŸ: {len(successful_results)}")
    print(f"å¤±æ•—: {len(failed_results)}")
    
    # è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆã‚’è¡¨ç¤º
    profiler.print_detailed_report()

# å®Ÿè¡Œ
await run_performance_demo()
```

ã“ã®ç« ã§ã¯ã€Pythonã«ãŠã‘ã‚‹éåŒæœŸãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®åŸºæœ¬æ¦‚å¿µã‹ã‚‰å®Ÿè·µçš„ãªå¿œç”¨ã¾ã§å­¦ç¿’ã—ã¾ã—ãŸã€‚éåŒæœŸãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’é©åˆ‡ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€I/Oãƒã‚¦ãƒ³ãƒ‰ãªã‚¿ã‚¹ã‚¯ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å¤§å¹…ã«å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚